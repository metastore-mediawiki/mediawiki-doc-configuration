<?php

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * MediaWiki: LocalSettings - Common - Extensions.
 * ---------------------------------------------------------------------------------------------------------------------
 * @author Kitsune Solar <https://kitsune.solar>
 * @version 1.0.0
 * ---------------------------------------------------------------------------------------------------------------------
 */

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Contrib - CategoryTree.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'CategoryTree' );
$wgCategoryTreeAllowTag = false;

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Contrib - Cite.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'Cite' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Contrib - ConfirmEdit.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtensions( [ 'ConfirmEdit', 'ConfirmEdit/QuestyCaptcha' ] );
$extRandCaptcha = mt_rand( 10000000, 99999999 );

// Questions.
$wgCaptchaQuestions = [
	'Введите символы (Enter characters): <code>' . $extRandCaptcha . '</code>' => $extRandCaptcha,
];

$ceAllowConfirmedEmail = true;

// Permissions.
$wgGroupPermissions['emailconfirmed']['skipcaptcha'] = true;
$wgGroupPermissions['autoconfirmed']['skipcaptcha']  = true;

// Triggers.
$wgCaptchaTriggers['edit']   = true;
$wgCaptchaTriggers['create'] = true;

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Contrib - InputBox.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'InputBox' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Contrib - Interwiki.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'Interwiki' );
$wgGroupPermissions['sysop']['interwiki'] = true;

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Contrib - MultimediaViewer.
 * ---------------------------------------------------------------------------------------------------------------------
 */

require_once( $IP . '/extensions/MultimediaViewer/MultimediaViewer.php' );
$wgMediaViewerEnableByDefault             = true;
$wgMediaViewerEnableByDefaultForAnonymous = true;
$wgMediaViewerUseThumbnailGuessing        = true;

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Contrib - ParserFunctions.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'ParserFunctions' );
$wgPFEnableStringFunctions = true;

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Contrib - Poem.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'Poem' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Contrib - Renameuser.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'Renameuser' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Contrib - SpamBlacklist.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'SpamBlacklist' );
$wgSpamBlacklistFiles = [
	'https://meta.wikimedia.org/w/index.php?title=Spam_blacklist&action=raw&sb_ver=1',
	'https://en.wikipedia.org/w/index.php?title=MediaWiki:Spam-blacklist&action=raw&sb_ver=1',
	'https://ru.wikipedia.org/w/index.php?title=MediaWiki:Spam-blacklist&action=raw&sb_ver=1',
	$IP . '/ext-network/storage/spam.blacklist/custom.txt'
];

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Contrib - SyntaxHighlight_GeSHi.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'SyntaxHighlight_GeSHi' );
$wgPygmentizePath = '/usr/bin/pygmentize-3.4';

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Contrib - WikiEditor.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'WikiEditor' );
$wgHiddenPrefs[] = 'usebetatoolbar';

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - AdvancedSearch.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'AdvancedSearch' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - AntiSpoof.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'AntiSpoof' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Local: Extension.Custom - Cargo.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'Cargo' );
$wgCargoDBtype     = extGetConfig( 'extension' )['cargo']['db']['type'];
$wgCargoDBserver   = extGetConfig( 'extension' )['cargo']['db']['server'];
$wgCargoDBuser     = extGetConfig( 'extension' )['cargo']['db']['user'];
$wgCargoDBpassword = extGetConfig( 'extension' )['cargo']['db']['password'];

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - CharInsert.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'CharInsert' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - CirrusSearch.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'Elastica' );
require_once( $IP . '/extensions/CirrusSearch/CirrusSearch.php' );

$wgCirrusSearchServers          = [ '127.0.0.1' ];
$wgCirrusSearchMultiWikiIndices = true;
$wgCirrusSearchIndexBaseName    = $srvProjectID;
$wgSearchType                   = 'CirrusSearch';

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - CLDR.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'cldr' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - CommonsMetadata.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'CommonsMetadata' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - Description2.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'Description2' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - DynamicPageList.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'DynamicPageList' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - Echo.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'Echo' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - FlaggedRevs.
 * ---------------------------------------------------------------------------------------------------------------------
 */

require_once( $IP . '/extensions/FlaggedRevs/FlaggedRevs.php' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - Kartographer.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'Kartographer' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - MobileFrontend.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'MobileFrontend' );
$wgMFAutodetectMobileView = true;

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - PageImages.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'PageImages' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - Popups.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'Popups' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - RelatedArticles.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'RelatedArticles' );
$wgRelatedArticlesUseCirrusSearch        = true;
$wgRelatedArticlesFooterWhitelistedSkins = [ 'vector', 'minerva' ];

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - RevisionSlider.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'RevisionSlider' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - SecurePoll.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'SecurePoll' );
$wgGroupPermissions['sysop']['securepoll-create-poll'] = true;

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - ShortUrl.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'ShortUrl' );
$wgShortUrlTemplate = '/index.php/Special:ShortUrl/$1';

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - TextExtracts.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'TextExtracts' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - Thanks.
 * ---------------------------------------------------------------------------------------------------------------------
 */

wfLoadExtension( 'Thanks' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - TorBlock.
 * ---------------------------------------------------------------------------------------------------------------------
 */

require_once( $IP . '/extensions/TorBlock/TorBlock.php' );

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.Custom - VipsScaler.
 * ---------------------------------------------------------------------------------------------------------------------
 */

require_once( $IP . '/extensions/VipsScaler/VipsScaler.php' );
$wgVipsCommand = '/usr/bin/vips';

/**
 * ---------------------------------------------------------------------------------------------------------------------
 * Global: Extension.METADATA - MW_EXT_*.
 * ---------------------------------------------------------------------------------------------------------------------
 */

# MW_EXT_Kernel
wfLoadExtension( 'MW_EXT_Kernel' );

# MW_EXT_Theme
wfLoadExtension( 'MW_EXT_Theme' );

# MW_EXT_Meta
wfLoadExtension( 'MW_EXT_Meta' );

# MW_EXT_SEO
wfLoadExtension( 'MW_EXT_SEO' );

# MW_EXT_Grid
wfLoadExtension( 'MW_EXT_Grid' );

# MW_EXT_Embed
wfLoadExtension( 'MW_EXT_Embed' );

# MW_EXT_Icon
wfLoadExtension( 'MW_EXT_Icon' );

# MW_EXT_Key
wfLoadExtension( 'MW_EXT_Key' );

# MW_EXT_Msg
wfLoadExtension( 'MW_EXT_Issue' );

# MW_EXT_Note
wfLoadExtension( 'MW_EXT_Note' );

# MW_EXT_Quote
wfLoadExtension( 'MW_EXT_Quote' );

# MW_EXT_InfoBox
wfLoadExtension( 'MW_EXT_InfoBox' );

# MW_EXT_URL
wfLoadExtension( 'MW_EXT_URL' );

# MW_EXT_License
wfLoadExtension( 'MW_EXT_License' );

# MW_EXT_Spoiler
wfLoadExtension( 'MW_EXT_Spoiler' );

# MW_EXT_EditorToolbar
wfLoadExtension( 'MW_EXT_EditorToolbar' );

# MW_EXT_EditorSummaryButtons
wfLoadExtension( 'MW_EXT_EditorSummaryButtons' );